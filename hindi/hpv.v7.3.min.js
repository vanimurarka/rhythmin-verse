class cChar{constructor(e,a){this.mainChar=e,this.mainCharCode=a,this.vowelChar="",this.vowelNumber=0,this.index=0,this.maatraa=0,this.systemMaatraa=0,this.maatraaCumulative=0,this.maapneeType=-1,this.isRadeef=!1,this.isKaafiyaa=!1,this.isHindi=!1,this.rhymeLevel=0,this.rhymeGroup=-1,32!=a&&44!=a||(this.vowel=e),a>=2309&&a<=2324&&(this.vowel=e),49!=a&&50!=a&&2407!=a&&2408!=a||(this.vowel=e),(a>=2325&&a<=2361||a>=2392&&a<=2399)&&(this.vowel="अ"),2305==a&&(this.vowel="ँ"),2306==a&&(this.vowel="्")}replaceMainChar(e){if("़"==e)switch(this.mainChar){case"क":this.mainChar="क़",this.mainCharCode=2392;break;case"ख":this.mainChar="ख़",this.mainCharCode=2393;break;case"ग":this.mainChar="ग़",this.mainCharCode=2394;break;case"ज":this.mainChar="ज़",this.mainCharCode=2395;break;case"ड":this.mainChar="ड़",this.mainCharCode=2396;break;case"ढ":this.mainChar="ढ़",this.mainCharCode=2397;break;case"फ":this.mainChar="फ़",this.mainCharCode=2398;break}}set vowel(e){switch(this.vowelChar=e,e){case"ँ":this.isHindi=!0;break;case"्":this.vowelNumber=-1,this.isHindi=!0;break;case"अ":this.vowelNumber=1;break;case"आ":case"ा":this.vowelNumber=2;break;case"इ":case"ि":this.vowelNumber=3;break;case"ई":case"ी":this.vowelNumber=4;break;case"उ":case"ु":this.vowelNumber=5;break;case"ऊ":case"ू":this.vowelNumber=6;break;case"ए":case"े":this.vowelNumber=7;break;case"ऐ":case"ै":this.vowelNumber=8;break;case"ओ":case"ो":this.vowelNumber=9;break;case"औ":case"ौ":this.vowelNumber=10;break;case"ऑ":case"ॉ":this.vowelNumber=11;break;case"ऋ":case"ृ":this.vowelNumber=12;break;case"1":case"१":this.vowelNumber=21;break;case"2":case"२":this.vowelNumber=22;break;default:this.vowelNumber=-10}switch(this.vowelNumber){case 1:case 3:case 5:case 12:case 21:this.maatraa=1,this.systemMaatraa=1,this.isHindi=!0;break;case 2:case 4:case 6:case 8:case 10:case 7:case 9:case 10:case 11:case 22:this.maatraa=2,this.systemMaatraa=2,this.isHindi=!0;break;default:this.maatraa=0,this.systemMaatraa=0;break}}isHalfLetter(){return-1==this.vowelNumber}isPureVowel(){return this.mainChar==this.vowelChar}isLaghu(){switch(this.vowelNumber){case 1:case 3:case 5:case 12:return!0;break;default:return!1;break}}isDeergha(){switch(this.vowelNumber){case 2:case 4:case 6:case 8:case 10:case 7:case 9:case 10:return!0;break;default:return!1;break}}calculateHalfLetterLen(e=!1,a=!1){return e?-10===e.vowelNumber||"म"==this.mainChar&&"ह"==a.mainChar||"न"==this.mainChar&&"ह"==a.mainChar?(this.maatraa=0,this.systemMaatraa=0,this.maatraa):e.isLaghu()||a&&e.isDeergha()&&a.isDeergha()?(this.maatraa=1,this.systemMaatraa=1,this.maatraa):0:(this.maatraa=0,this.systemMaatraa=0,this.maatraa)}adjustCharMaatraa(){(this.vowelNumber<=6&&this.vowelNumber%2==0||this.vowelNumber>6&&this.vowelNumber<12)&&(1==this.maatraa?this.maatraa=2:this.maatraa=1),-1==this.vowelNumber&&(0==this.maatraa?this.maatraa=1:this.maatraa=0)}get text(){let e="";return-10!=this.vowelNumber&&0!=this.vowelNumber&&(e=this.isPureVowel()||1==this.vowelNumber?this.mainChar:this.mainChar+this.vowelChar),e}get joinedConsonantVowel(){return this.mainChar==this.vowelChar?this.vowelChar:"अ"==this.vowelChar?this.mainChar:this.mainChar+this.vowelChar}compare(e){return this.text==e.text?"all":!(this.vowelNumber!=e.vowelNumber||this.mainChar==e.mainChar||!this.isHindi||!e.isHindi)&&"vowel"}}class cLine{constructor(e){this.originalText=e,this.characters=new Array,this.count=0,this.maatraa=0,this.isComposite=!1,this.rhymeFound=!1,this.rhymeGroup=0,this.rhymeLength=0}get text(){return this.originalText}lastCharVowel(e){const a=this.characters[this.count-1],t=a.maatraa;a.vowel=e,this.maatraa+=a.maatraa-t,a.maatraaCumulative+=a.maatraa-t}changeLastCharConsonant(e){this.characters[this.count-1].replaceMainChar(e)}push(e){e.index=this.count,0==e.index?e.maatraaCumulative=e.maatraa:e.maatraaCumulative=this.characters[this.count-1].maatraaCumulative+e.maatraa,this.characters.push(e),this.maatraa+=e.maatraa,this.count++}charByIndex(e){return this.characters[e]}charByReverseIndex(e){return(e=this.count-1-e)>0&&this.characters[e]}previousChar(e){return 0!=e.index&&this.count>1&&this.characters[e.index-1]}nextChar(e){return this.count>1&&e.index<this.count-1&&this.characters[e.index+1]}getLastChar(){return 0!=this.count&&this.characters[this.count-1]}getHalfLetters(){return this.characters.filter((function(e){return e.isHalfLetter()}))}calculateHalfLettersMaatraa(){const e=this.getHalfLetters();let a,t=0;for(a=0;a<e.length;a++){const r=e[a];if(t=0,0==r.index)t=r.calculateHalfLetterLen();else{const e=this.previousChar(r),a=this.nextChar(r);t=r.calculateHalfLetterLen(e,a)}if(t>0){let e;for(this.maatraa+=t,r.maatraaCumulative+=t,e=r.index+1;e<this.count;e++)this.characters[e].maatraaCumulative++}}}adjustCharMaatraa(e,a){let t=this.charByIndex(e),r=t.maatraa;t.adjustCharMaatraa();let i,s=t.maatraa-r;for(this.maatraa+=s,i=e;i<this.count;i++)this.charByIndex(i).maatraaCumulative+=s;return this.clearMaapnee(),this.setMaapnee(a),this.maatraa}doesItRhyme(e,a){let t=0,r=0,i=[],s=[];for(;;){let a,n;if(a=this.charByReverseIndex(t),!a)return!1;if(a.isHindi){if(n=e.charByReverseIndex(r),!n)return!1;if(n.isHindi){if("all"==a.compare(n)){i[i.length]=[t,2],s[s.length]=[r,2],t++,r++;break}return!1}r++}else t++}let n,h,o=1,c=0;for(;n=this.charByReverseIndex(t),n;){if(!n.isHindi){t++;continue}if(h=e.charByReverseIndex(r),!h)break;if(!h.isHindi){r++;continue}let a=n.compare(h);if("all"==a&&0==c)i[i.length]=[t,2],s[s.length]=[r,2],t++,r++,o++;else{if("vowel"!=a)break;i[i.length]=[t,1],s[s.length]=[r,1],t++,r++,c++}}if(o+c>1){let r=o+c;if(r>this.rhymeLength)for(t=0;t<i.length;t++){let e=this.charByReverseIndex(i[t][0]);e.rhymeLevel=i[t][1],e.rhymeGroup=a}if(r>e.rhymeLength)for(t=0;t<s.length;t++){let r=e.charByReverseIndex(s[t][0]);r.rhymeLevel=s[t][1],r.rhymeGroup=a}return r}return!1}setMaapnee(e=[]){let a,t,r=0,i=0,s=!1;for(e.length>0&&(s=!0),r=0;r<this.count;r++)if(a=this.characters[r],t=e[i],a.isHindi){if(1.5!=a.maapneeType&&(a.maapneeType=a.maatraa),s&&2==a.maapneeType){i++;continue}if("1"==a.mainChar||"१"==a.mainChar){i++;continue}if(r<this.count-1&&1==a.maatraa&&1.5!=a.maapneeType){let t=a,r=!1;for(;!r&&(t=this.nextChar(t),!1!==t);)t.isHindi&&t.maatraa>0&&(r=!0);1==t.maatraa&&1==a.maatraa?s?(1==e[i]||(t.maapneeType=1.5,a.maapneeType=1.5),i++):(t.maapneeType=1.5,a.maapneeType=1.5):i++}else 1==a.maapneeType&&i++}else s&&0==t&&(a.maapneeType=0,i++)}clearMaapnee(){let e=0;for(e=0;e<this.count;e++)this.characters[e].maapneeType=-1}}class compositeLine{constructor(e){this.originalLineIdx=e,this.maatraa=0,this.remainder=0}}class cPoem{constructor(e){this.originalText=e,this.lines=new Array,this.lineCount=0,this.maxLineLen=0,this.compositeLines=[],this.baseCount=1,this.radeefTruncated=0,this.radeefArray=[],this.firstLineMaapnee=!1,this.maapneePattern=[]}pushLine(e){this.lines.push(e),this.lineCount++,this.maxLineLen<e.maatraa&&(this.maxLineLen=e.maatraa),1==this.lineCount&&(this.detectFirstLineMaapnee(),this.firstLineMaapnee&&this.setMaapneePattern())}get text(){return this.originalText}adjustCharMaatraa(e,a){let t=this.lines[e].adjustCharMaatraa(a,this.maapneePattern);this.maxLineLen<t&&(this.maxLineLen=t)}setComposite(e){this.lines[e].isComposite=!this.lines[e].isComposite,this.calculateCompositeMaatraa()}setBaseCount(e){this.baseCount=e,this.calculateCompositeMaatraa()}calculateCompositeMaatraa(){let e,a=!1;if(this.compositeLines.length=0,this.lineCount>1){let e=0;for(e=1;e<this.lines.length;e++)if(this.lines[e].isComposite){let t=this.compositeLines.length;a?this.compositeLines[t-1].maatraa+=this.lines[e].maatraa:(a=!0,this.compositeLines[t]=new compositeLine(e-1),this.compositeLines[t].maatraa=this.lines[e-1].maatraa,this.compositeLines[t].maatraa+=this.lines[e].maatraa),t=this.compositeLines.length,this.compositeLines[t-1].maatraa%this.baseCount==0?this.compositeLines[t-1].multipleOfBaseCount=!0:this.compositeLines[t-1].multipleOfBaseCount=!1}else a&&(a=!1)}for(e=0;e<this.compositeLines.length;e++)this.calculateRemainder(e)}calculateRemainder(e){if(this.baseCount>1){let a=this.compositeLines[e].maatraa,t=a%this.baseCount;if(0!=t){let r=a/this.baseCount,i=parseInt(r),s=r-i;this.compositeLines[e].remainder=s<=.5?t:-1*((i+1)*this.baseCount-a)}}else this.compositeLines[e].remainder=0}calculateRadeef(){let e,a,t="";this.radeefArray=[];let r=!1,i=this.lines[0].count-1,s=this.lines[1].count-1;for(;!r&&i>=0&&s>=0;)e=this.lines[0].characters[i].joinedConsonantVowel,a=this.lines[1].characters[s].joinedConsonantVowel,e==a?(t=e+t,this.radeefArray[this.radeefArray.length]=[],this.radeefArray[this.radeefArray.length-1][0]=this.lines[0].characters[i].mainChar,this.radeefArray[this.radeefArray.length-1][1]=this.lines[0].characters[i].vowelChar,i--,s--):r=!0;let n=t.substr(t.indexOf(" ")+1);if(t!==n){for(this.radeefTruncated=1,i=this.radeefArray.length-1;i>=0&&" "!=this.radeefArray[i][0];i--);this.radeefArray.length=i,t=n}let h=this.radeefArray.length;for(i=0;i<this.lines.length;i++){let e=!1;i<=1&&(e=!0),i>1&&i<this.lines.length-1&&0==this.lines[i+1].characters.length&&(e=!0),i==this.lines.length-1&&(e=!0);let a=this.lines[i].characters.length;if(e&&a>h)for(let e=0;e<h&&(this.radeefArray[e][0]==this.lines[i].characters[a-1-e].mainChar&&this.radeefArray[e][1]==this.lines[i].characters[a-1-e].vowelChar);e++)this.lines[i].characters[a-1-e].isRadeef=!0}}calculateKaafiyaa(){let e,a,t,r=this.radeefArray.length,i=!1,s=[],n=this.lines[0].characters.length-1-r,h=this.lines[1].characters.length-1-r;for(;!i&&n>=0&&h>=0;)a=this.lines[0].characters[n].vowelNumber,t=this.lines[1].characters[h].vowelNumber,a==t?(e=a+e,s[s.length]=a,n--,h--):i=!0;-10==s[0]&&s.splice(0,1);let o=s.length;for(n=0;n<this.lines.length;n++){let e=!1;n<=1&&(e=!0),n>1&&n<this.lines.length-1&&0==this.lines[n+1].characters.length&&(e=!0),n==this.lines.length-1&&(e=!0);let a=this.lines[n].characters.length;if(e&&a>r+o+this.radeefTruncated)for(h=0;h<o&&s[h]==this.lines[n].characters[a-1-r-this.radeefTruncated-h].vowelNumber;h++)this.lines[n].characters[a-1-r-this.radeefTruncated-h].isKaafiyaa=!0}}findRhymingLines(){if(this.lineCount<2)return;let e=0,a=1,t=!1,r=0,i=!1;for(e=0;e<this.lineCount-1;e++){let s=this.lines[e];for(t=!1,a=e+1,this.lineCount<=a&&(t=!0);!t;){let e=this.lines[a],n=s.doesItRhyme(e,r);n&&(s.rhymeLength<n&&(s.rhymeLength=n,s.rhymeFound=!0,s.rhymeGroup=r,i=!0),e.rhymeLength<n&&(e.rhymeLength=n,e.rhymeFound=!0,e.rhymeGroup=r,i=!0)),a++,this.lineCount<=a&&(t=!0,i&&(i=!1,r++))}}}detectFirstLineMaapnee(){if(this.lineCount<1)return;let e=this.lines[0];this.firstLineMaapnee=/^[12१२\s]+$/.test(e.text)}setMaapneePattern(){let e=this.lines[0],a=0;for(a=0;a<e.count;a++)1==e.characters[a].systemMaatraa||2==e.characters[a].systemMaatraa?this.maapneePattern[this.maapneePattern.length]=e.characters[a].systemMaatraa:this.maapneePattern[this.maapneePattern.length]=0}}class cVisual{constructor(e){this.availableW=e,this.mode="fixed",this.userMode="",this.width=0,this.ratio=1}setMode(e,a,t){this.mode=e,this.width=a,this.ratio=t}}var oPoem,oPrevPoem,oVisual,rhymeColors=["#ff8004","#fd4c48","#9203ff","#ff00a0","#a4ff00"];function visualize(e,a,t=0,r=!1){if(r&&(fGhazal=0,fFreeVerse=0),1==t&&(fGhazal=!0),2==t&&(fFreeVerse=!0),splitNprocessPoem(e,r),fGhazal&&(oPoem.calculateRadeef(),oPoem.calculateKaafiyaa()),fFreeVerse){let e=parseInt(document.getElementById("baseCount").value);oPoem.setBaseCount(e)}oVisual=new cVisual(a),draw()}function redraw(e){oVisual=new cVisual(e),draw()}function splitNprocessPoem(e,a){a||(oPrevPoem=oPoem);const t=(oPoem=new cPoem(e)).text.split("\n");let r=[];void 0!==oPrevPoem&&(r=oPrevPoem.originalText.split("\n"));const i=t.length;let s;for(s=0;s<i;s++)if(s<r.length&&t[s]==r[s])oPoem.pushLine(oPrevPoem.lines[s]);else{t[s]=t[s].replace(/[^\u0900-\u097F 12]/g," "),t[s]=t[s].replace("।"," "),t[s]=t[s].replace(/\s+/g," "),t[s]=t[s].trim();const e=new cLine(t[s]);for(k=0;k<t[s].length;k++){charCode=t[s].charCodeAt(k);let a=t[s].substring(k,k+1);2364==charCode?e.changeLastCharConsonant(a):charCode>=2366&&charCode<=2381?e.lastCharVowel(a):(oChar=new cChar(a,charCode),e.push(oChar))}e.calculateHalfLettersMaatraa(),oPoem.pushLine(e),oPoem.lines[oPoem.lineCount-1].setMaapnee(oPoem.maapneePattern)}}var charW=20,charH=20,paddingLeft=2,lineSpacing=5,fShowText=!0,fLineSpacing=!0,fFreeVerse=!1,fGhazal=!1,fRhymingLines=!1;function initSvgFixed(e,a){return d3.select("#chart").append("svg").attr("width",(function(){return e})).attr("height",(function(){return a})).attr("style","border-bottom: solid 1px #ddd;background-color:white")}function initSvgFlex(e){return d3.select("#chart").append("svg").attr("viewBox",e).attr("preserveAspectRatio","xMidYMid meet").attr("style","border-bottom: solid 1px #ddd;background-color:white")}function draw(){const e=oPoem.maxLineLen,a=oPoem.lineCount;d3.select("#chart").select("svg").remove();const t=fFreeVerse?charW*e+70:charW*e+30,r=fLineSpacing?a*(charH+lineSpacing)+2*charH:a*charH+2*charH,i="0 0 "+t+" "+r,s=oVisual.availableW/t;var n;if(oVisual.availableW<=500||s>=.6&&s<=1?oVisual.setMode("flexible",t,s):oVisual.setMode("fixed",t,s),n=""==oVisual.userMode?"fixed"==oVisual.mode?initSvgFixed(t,r):initSvgFlex(i):"fixed"==oVisual.userMode?initSvgFixed(t,r):initSvgFlex(i),fLineSpacing)var h=n.selectAll("g").data(oPoem.lines).enter().append("svg:g").attr("transform",(function(e,a){return"translate("+paddingLeft+","+(a*(charH+lineSpacing)+(charH+lineSpacing))+")"})).attr("id",(function(e,a){return"gLine"+a}));else h=n.selectAll("g").data(oPoem.lines).enter().append("svg:g").attr("transform",(function(e,a){return"translate("+paddingLeft+","+(a*charH+charH)+")"})).attr("id",(function(e,a){return"gLine"+a}));fShowText&&h.selectAll("text").data((function(e){return e.characters})).enter().append("svg:text").attr("y",charH-2).attr("x",(function(e){return drawCharTxtPos(e)})).attr("class","graphText3").attr("text-anchor","middle").text((function(e){return e.text})),h.selectAll("path").data((function(e){return e.characters})).enter().append("path").attr("id",(function(e,a){return"char"+a})).attr("style",(function(e,a){return drawStyleCharBlock(e,fGhazal?"ghazal":"consonant")})).attr("d",(function(e,a){return drawVowPath(e,a)})).attr("title",(function(e,a){return e.mainChar+e.vowelChar})).on("click",adjustCharLen),fFreeVerse?(h.append("svg:text").attr("y",charH).attr("x",(function(a){return charW*e+5})).attr("class","graphText3").text((function(e){return e.maatraa>0?e.maatraa:""})).on("click",markCompositeLine),h.append("svg:line").attr("x1",(function(a,t){return charW*e+(charW+5)})).attr("y1",(function(e,a){return charH-2})).attr("x2",(function(a){return charW*e+(charW+10)})).attr("y2",charH-2).attr("style",(function(e,a){return drawFreeVerseDashStyle(a)})).on("click",markCompositeLine),h.append("svg:line").attr("x1",(function(e,a){return drawCompositeLineMarker("x1",a)})).attr("y1",(function(e,a){return drawCompositeLineMarker("y1",a)})).attr("x2",(function(a){return charW*e+(charW+12)})).attr("y2",charH+2).attr("style",(function(e,a){return drawCompositeLineMarker("style",a)})).on("click",unmarkCompositeLine),drawCompositeNumbers()):h.append("svg:text").attr("y",charH).attr("x",(function(a){return charW*e+5})).attr("class","graphText3").text((function(e){return e.maatraa>0?e.maatraa:""}))}function drawCharTxtPos(e){return(e.maatraaCumulative-e.maatraa)*charW+charW*e.maatraa/2}function drawStyleCharBlock(e,a){if(-10===e.vowelNumber)return 0==e.maapneeType?"stroke:rgb(0,118,255);stroke-width:3":"display: none";var t="rgb(0,220,255)",r="0.3",i="0.4",s="black";return"consonant"==a&&(e.maatraa==e.systemMaatraa?(2==e.systemMaatraa&&(t="rgb(0,255,0)",i="0.4"),1.5==e.maapneeType&&(t="rgb(0,255,0)",i="0.2"),e.rhymeLevel>0&&fRhymingLines&&(i="0.4",void 0===(t=rhymeColors[e.rhymeGroup])&&(t="white",i="0.2"))):(t="yellow",i="0.5")),"ghazal"==a&&(e.maatraa==e.systemMaatraa?(e.isRadeef&&(t="rgb(0,220,255)",i="0.5"),e.isKaafiyaa&&(t="rgb(0,255,0)",i="0.5")):(t="yellow",i="0.5")),-1==e.vowelNumber&&0==e.maatraa&&(t="black",i="0.6",e.maatraa!==e.systemMaatraa&&(t="yellow",i="1",s="orange",r="1")),"fill: "+t+"; fill-opacity: "+i+";stroke:"+s+"; stroke-width: 1; stroke-opacity: "+r}function drawVowPath(e,a){var t=(e.maatraaCumulative-e.maatraa)*charW,r=charW*e.maatraa,i=charH;return-1==e.vowelNumber&&0==e.maatraa?"M"+(t-=2)+",0 L"+t+",-"+(i=4)+" L"+(t+(r=4))+",-"+i+" L"+(t+r)+",0 z":"M"+t+",0 L"+t+","+i+" L"+(t+r)+","+i+" L"+(t+r)+",0 z"}function fnShowText(){fShowText=!fShowText,draw()}function fnRhymingLines(){(fRhymingLines=!fRhymingLines)&&!fGhazal&&oPoem.findRhymingLines(),draw()}function drawFreeVerseDashStyle(e){return 0==oPoem.lines[e].maatraa?"display:none;":"stroke:black;stroke-width:8;"}function fnFreeVerseSupport(e=1){if(fFreeVerse=!fFreeVerse){parseInt(document.getElementById("baseCount").value);oPoem.setBaseCount(e)}draw()}function fnFit(e){var a=e.checked;oVisual.userMode=a?"flexible":"fixed",draw()}function drawCompositeLineMarker(e,a){const t=oPoem.maxLineLen;return"x1"==e?0==a?charW*t+2*charW:oPoem.lines[a].isComposite?charW*t+(charW+12):charW*t+2*charW:"y1"==e?oPoem.lines[a].isComposite?fLineSpacing?-11:0:charH-2:"style"==e?0!=oPoem.lines[a].maatraa&&oPoem.lines[a].isComposite?"stroke:green;stroke-width:6;":"display:none;":void 0}function drawCompositeNumbers(){const e=oPoem.maxLineLen;let a=d3.select("#chart").select("svg"),t=0;t=fLineSpacing?charH+lineSpacing:charH;a.selectAll(".compositeCountT").data(oPoem.compositeLines).enter().append("svg:text").attr("y",(function(e){return e.originalLineIdx*t+t+charH})).attr("x",(function(a){return paddingLeft+charW*e+(charW+20)})).attr("class","compositeCountT").attr("style",(function(e){return e.multipleOfBaseCount?"fill:black":"fill:red"})).text((function(e){return e.maatraa})),a.selectAll(".compositeCountR").data(oPoem.compositeLines).enter().append("svg:text").attr("y",(function(e){return e.originalLineIdx*t+t+charH+10})).attr("x",(function(a){return paddingLeft+charW*e+(charW+20+10)})).attr("class","compositeCountR").attr("style",(function(e){return 0!=e.remainder?"fill:red;font-size:80%":"display:none"})).text((function(e){return e.remainder>0?"+"+e.remainder:e.remainder}))}function fnLineSpacing(){fLineSpacing=!fLineSpacing,draw()}function adjustCharLen(){var e=parseInt(this.getAttribute("id").substring(4)),a=parseInt(this.parentNode.getAttribute("id").substring(5));oPoem.adjustCharMaatraa(a,e),draw()}function markCompositeLine(){let e=parseInt(this.parentNode.getAttribute("id").substring(5));e<oPoem.lines.length-1&&!oPoem.lines[e+1].isComposite&&(oPoem.setComposite(e+1),draw())}function unmarkCompositeLine(){var e=parseInt(this.parentNode.getAttribute("id").substring(5));e>0&&(oPoem.setComposite(e),draw())}function fnBaseCountChange(e=1){e>0&&e!=oPoem.baseCount&&(oPoem.setBaseCount(e),draw())}function fnGhazal(){(fGhazal=!fGhazal)&&(oPoem.calculateRadeef(),oPoem.calculateKaafiyaa()),draw()}function saveSVG(){var e=document.getElementById("chart").querySelector("svg"),a=document.createElement("canvas"),t=(new XMLSerializer).serializeToString(e);if(-1==t.search("viewBox")){var r=e.getBoundingClientRect().width,i=e.getBoundingClientRect().height;a.width=r,a.height=i+10;var s='<svg xmlns="http://www.w3.org/2000/svg" width="'+r+'" height="';t=t.substring(s.length+i.toString().length),t=(t=s+(i+10)+t).substring(0,t.length-6),t+='<text x="2" y="'+(i+10-4)+'">geet-gatiroop.com</text></svg>'}else{var n=e.viewBox.baseVal;a.width=n.width,a.height=n.height+10,a.height+=10;s='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '+n.width+" ";t=t.substring(s.length+n.height.toString().length),t=(t=s+(n.height+10)+t).substring(0,t.length-6),t+='<text x="2" y="'+(n.height+10-4)+'">geet-gatiroop.com</text></svg>'}var h=window.URL||window.webkitURL||window,o=new Image,c=new Blob([t],{type:"image/svg+xml"}),l=h.createObjectURL(c);o.onload=function(){a.getContext("2d").drawImage(o,0,0),h.revokeObjectURL(l);var e=a.toDataURL("image/png").replace("image/png","octet/stream"),t=document.createElement("a");document.body.appendChild(t),t.style="display: none",t.href=e,t.download="geetgatiroop-output.png",t.click(),window.URL.revokeObjectURL(e),document.body.removeChild(t)},o.src=l}